openapi: 3.0.3
info:
  title: Enzyme API
  description: REST API for Enzyme, a self-hostable Slack alternative
  version: 1.0.0

servers:
  - url: /api
    description: API server

tags:
  - name: server
    description: Server information
  - name: auth
    description: Authentication endpoints
  - name: users
    description: User profile management
  - name: workspaces
    description: Workspace management
  - name: channels
    description: Channel management
  - name: messages
    description: Message operations
  - name: files
    description: File uploads and downloads
  - name: emojis
    description: Custom emoji management
  - name: sse
    description: Server-Sent Events

paths:
  # Server endpoints
  /server-info:
    get:
      tags: [server]
      summary: Get server information
      operationId: getServerInfo
      responses:
        '200':
          description: Server information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerInfo'

  # Auth endpoints
  /auth/register:
    post:
      tags: [auth]
      summary: Register a new user
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterInput'
      responses:
        '200':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /auth/login:
    post:
      tags: [auth]
      summary: Log in a user
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginInput'
      responses:
        '200':
          description: User logged in successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/logout:
    post:
      tags: [auth]
      summary: Log out the current user
      operationId: logout
      responses:
        '200':
          description: User logged out successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /auth/forgot-password:
    post:
      tags: [auth]
      summary: Request a password reset
      operationId: forgotPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email]
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Password reset email sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string

  /auth/reset-password:
    post:
      tags: [auth]
      summary: Reset password with token
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [token, new_password]
              properties:
                token:
                  type: string
                new_password:
                  type: string
      responses:
        '200':
          description: Password reset successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /auth/me:
    get:
      tags: [auth]
      summary: Get current user info
      operationId: getMe
      responses:
        '200':
          description: Current user information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MeResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # Workspace endpoints
  /workspaces/create:
    post:
      tags: [workspaces]
      summary: Create a new workspace
      operationId: createWorkspace
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWorkspaceInput'
      responses:
        '200':
          description: Workspace created
          content:
            application/json:
              schema:
                type: object
                properties:
                  workspace:
                    $ref: '#/components/schemas/Workspace'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /workspaces/{wid}:
    get:
      tags: [workspaces]
      summary: Get workspace details
      operationId: getWorkspace
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      responses:
        '200':
          description: Workspace details
          content:
            application/json:
              schema:
                type: object
                properties:
                  workspace:
                    $ref: '#/components/schemas/Workspace'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /workspaces/{wid}/update:
    post:
      tags: [workspaces]
      summary: Update workspace
      operationId: updateWorkspace
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWorkspaceInput'
      responses:
        '200':
          description: Workspace updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  workspace:
                    $ref: '#/components/schemas/Workspace'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /workspaces/{wid}/members/list:
    post:
      tags: [workspaces]
      summary: List workspace members
      operationId: listWorkspaceMembers
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      responses:
        '200':
          description: List of members
          content:
            application/json:
              schema:
                type: object
                properties:
                  members:
                    type: array
                    items:
                      $ref: '#/components/schemas/WorkspaceMemberWithUser'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /workspaces/{wid}/members/remove:
    post:
      tags: [workspaces]
      summary: Remove a member from workspace
      operationId: removeWorkspaceMember
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_id]
              properties:
                user_id:
                  type: string
      responses:
        '200':
          description: Member removed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /workspaces/{wid}/members/update-role:
    post:
      tags: [workspaces]
      summary: Update member role
      operationId: updateWorkspaceMemberRole
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_id, role]
              properties:
                user_id:
                  type: string
                role:
                  $ref: '#/components/schemas/WorkspaceRole'
      responses:
        '200':
          description: Role updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /workspaces/{wid}/invites/create:
    post:
      tags: [workspaces]
      summary: Create an invite
      operationId: createWorkspaceInvite
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInviteInput'
      responses:
        '200':
          description: Invite created
          content:
            application/json:
              schema:
                type: object
                properties:
                  invite:
                    $ref: '#/components/schemas/Invite'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /workspaces/notifications:
    get:
      tags: [workspaces]
      summary: Get notification summaries for all workspaces
      operationId: getWorkspaceNotifications
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Notification summaries per workspace
          content:
            application/json:
              schema:
                type: object
                required: [workspaces]
                properties:
                  workspaces:
                    type: array
                    items:
                      $ref: '#/components/schemas/WorkspaceNotificationSummary'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /workspaces/reorder:
    post:
      tags: [workspaces]
      summary: Reorder workspaces for current user
      operationId: reorderWorkspaces
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReorderWorkspacesInput'
      responses:
        '200':
          description: Workspaces reordered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '400':
          $ref: '#/components/responses/BadRequest'

  /invites/{code}/accept:
    post:
      tags: [workspaces]
      summary: Accept an invite
      operationId: acceptInvite
      security:
        - bearerAuth: []
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Invite accepted
          content:
            application/json:
              schema:
                type: object
                properties:
                  workspace:
                    $ref: '#/components/schemas/Workspace'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Channel endpoints
  /workspaces/{wid}/channels/create:
    post:
      tags: [channels]
      summary: Create a channel
      operationId: createChannel
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateChannelInput'
      responses:
        '200':
          description: Channel created
          content:
            application/json:
              schema:
                type: object
                properties:
                  channel:
                    $ref: '#/components/schemas/Channel'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /workspaces/{wid}/channels/list:
    post:
      tags: [channels]
      summary: List channels in workspace
      operationId: listChannels
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      responses:
        '200':
          description: List of channels
          content:
            application/json:
              schema:
                type: object
                properties:
                  channels:
                    type: array
                    items:
                      $ref: '#/components/schemas/ChannelWithMembership'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /workspaces/{wid}/channels/dm:
    post:
      tags: [channels]
      summary: Create or get DM channel
      operationId: createDM
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_ids]
              properties:
                user_ids:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: DM channel
          content:
            application/json:
              schema:
                type: object
                properties:
                  channel:
                    $ref: '#/components/schemas/Channel'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /workspaces/{wid}/dm-suggestions:
    post:
      tags: [channels]
      summary: Get DM suggestions for sidebar
      description: Returns recent DMs and suggested users to start conversations with
      operationId: getDMSuggestions
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      responses:
        '200':
          description: DM suggestions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DMSuggestionsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /channels/{id}/update:
    post:
      tags: [channels]
      summary: Update channel
      operationId: updateChannel
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/channelId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateChannelInput'
      responses:
        '200':
          description: Channel updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  channel:
                    $ref: '#/components/schemas/Channel'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /channels/{id}/convert:
    post:
      tags: [channels]
      summary: Convert group DM to channel
      operationId: convertGroupDMToChannel
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/channelId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                description:
                  type: string
                type:
                  type: string
                  enum: [public, private]
                  default: private
      responses:
        '200':
          description: Channel converted
          content:
            application/json:
              schema:
                type: object
                properties:
                  channel:
                    $ref: '#/components/schemas/Channel'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /channels/{id}/archive:
    post:
      tags: [channels]
      summary: Archive channel
      operationId: archiveChannel
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/channelId'
      responses:
        '200':
          description: Channel archived
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /channels/{id}/members/add:
    post:
      tags: [channels]
      summary: Add member to channel
      operationId: addChannelMember
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/channelId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [user_id]
              properties:
                user_id:
                  type: string
                role:
                  $ref: '#/components/schemas/ChannelRole'
      responses:
        '200':
          description: Member added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /channels/{id}/members/list:
    post:
      tags: [channels]
      summary: List channel members
      operationId: listChannelMembers
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/channelId'
      responses:
        '200':
          description: List of members
          content:
            application/json:
              schema:
                type: object
                properties:
                  members:
                    type: array
                    items:
                      $ref: '#/components/schemas/ChannelMember'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /channels/{id}/join:
    post:
      tags: [channels]
      summary: Join a channel
      operationId: joinChannel
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/channelId'
      responses:
        '200':
          description: Joined channel
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /channels/{id}/leave:
    post:
      tags: [channels]
      summary: Leave a channel
      operationId: leaveChannel
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/channelId'
      responses:
        '200':
          description: Left channel
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /channels/{id}/star:
    post:
      tags: [channels]
      summary: Star a channel
      operationId: starChannel
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/channelId'
      responses:
        '200':
          description: Channel starred
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [channels]
      summary: Unstar a channel
      operationId: unstarChannel
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/channelId'
      responses:
        '200':
          description: Channel unstarred
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /channels/{id}/mark-read:
    post:
      tags: [channels]
      summary: Mark channel as read
      operationId: markChannelRead
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/channelId'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                message_id:
                  type: string
                  description: Message ID to mark as last read (defaults to latest message)
      responses:
        '200':
          description: Channel marked as read
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MarkReadResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /channels/{id}/notifications:
    get:
      tags: [channels]
      summary: Get channel notification preferences
      operationId: getChannelNotifications
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/channelId'
      responses:
        '200':
          description: Notification preferences
          content:
            application/json:
              schema:
                type: object
                properties:
                  preferences:
                    $ref: '#/components/schemas/NotificationPreferences'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    post:
      tags: [channels]
      summary: Update channel notification preferences
      operationId: updateChannelNotifications
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/channelId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NotificationPreferences'
      responses:
        '200':
          description: Preferences updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  preferences:
                    $ref: '#/components/schemas/NotificationPreferences'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /workspaces/{wid}/channels/mark-all-read:
    post:
      tags: [channels]
      summary: Mark all channels as read
      operationId: markAllChannelsRead
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      responses:
        '200':
          description: All channels marked as read
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /workspaces/{wid}/unreads:
    post:
      tags: [messages]
      summary: List all unread messages across channels
      operationId: listAllUnreads
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                limit:
                  type: integer
                  default: 50
                cursor:
                  type: string
      responses:
        '200':
          description: List of unread messages
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnreadMessagesResult'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /workspaces/{wid}/messages/search:
    post:
      tags: [messages]
      summary: Search messages in workspace
      operationId: searchMessages
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchMessagesInput'
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchMessagesResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /workspaces/{wid}/threads:
    post:
      tags: [messages]
      summary: List threads user is subscribed to
      operationId: listUserThreads
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                limit:
                  type: integer
                  default: 20
                cursor:
                  type: string
      responses:
        '200':
          description: List of user threads
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ThreadListResult'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # Message endpoints
  /messages/{id}:
    get:
      tags: [messages]
      summary: Get a single message
      operationId: getMessage
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/messageId'
      responses:
        '200':
          description: Message details
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    $ref: '#/components/schemas/MessageWithUser'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /channels/{id}/messages/send:
    post:
      tags: [messages]
      summary: Send a message
      operationId: sendMessage
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/channelId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendMessageInput'
      responses:
        '200':
          description: Message sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    $ref: '#/components/schemas/MessageWithUser'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /channels/{id}/messages/list:
    post:
      tags: [messages]
      summary: List messages in channel
      operationId: listMessages
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/channelId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListMessagesInput'
      responses:
        '200':
          description: List of messages
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageListResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /messages/{id}/update:
    post:
      tags: [messages]
      summary: Update a message
      operationId: updateMessage
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/messageId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content:
                  type: string
      responses:
        '200':
          description: Message updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    $ref: '#/components/schemas/MessageWithUser'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /messages/{id}/delete:
    post:
      tags: [messages]
      summary: Delete a message
      operationId: deleteMessage
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/messageId'
      responses:
        '200':
          description: Message deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /messages/{id}/reactions/add:
    post:
      tags: [messages]
      summary: Add reaction to message
      operationId: addReaction
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/messageId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [emoji]
              properties:
                emoji:
                  type: string
      responses:
        '200':
          description: Reaction added
          content:
            application/json:
              schema:
                type: object
                properties:
                  reaction:
                    $ref: '#/components/schemas/Reaction'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /messages/{id}/reactions/remove:
    post:
      tags: [messages]
      summary: Remove reaction from message
      operationId: removeReaction
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/messageId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [emoji]
              properties:
                emoji:
                  type: string
      responses:
        '200':
          description: Reaction removed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /messages/{id}/mark-unread:
    post:
      tags: [messages]
      summary: Mark message as unread
      operationId: markMessageUnread
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/messageId'
      responses:
        '200':
          description: Message marked as unread
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /messages/{id}/thread/mark-read:
    post:
      tags: [messages]
      summary: Mark thread as read
      operationId: markThreadRead
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/messageId'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                last_read_reply_id:
                  type: string
                  description: ID of the last read reply (defaults to latest reply)
      responses:
        '200':
          description: Thread marked as read
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /messages/{id}/thread/list:
    post:
      tags: [messages]
      summary: List thread replies
      operationId: listThread
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/messageId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListMessagesInput'
      responses:
        '200':
          description: Thread messages
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageListResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /messages/{id}/subscription:
    get:
      tags: [messages]
      summary: Get thread subscription status
      operationId: getThreadSubscription
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/messageId'
      responses:
        '200':
          description: Thread subscription status
          content:
            application/json:
              schema:
                type: object
                required: [status]
                properties:
                  status:
                    $ref: '#/components/schemas/ThreadSubscriptionStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /messages/{id}/subscribe:
    post:
      tags: [messages]
      summary: Subscribe to thread
      operationId: subscribeToThread
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/messageId'
      responses:
        '200':
          description: Subscribed to thread
          content:
            application/json:
              schema:
                type: object
                required: [status]
                properties:
                  status:
                    $ref: '#/components/schemas/ThreadSubscriptionStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /messages/{id}/unsubscribe:
    post:
      tags: [messages]
      summary: Unsubscribe from thread
      operationId: unsubscribeFromThread
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/messageId'
      responses:
        '200':
          description: Unsubscribed from thread
          content:
            application/json:
              schema:
                type: object
                required: [status]
                properties:
                  status:
                    $ref: '#/components/schemas/ThreadSubscriptionStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # File endpoints
  /channels/{id}/files/upload:
    post:
      tags: [files]
      summary: Upload a file
      operationId: uploadFile
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/channelId'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: File uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  file:
                    type: object
                    properties:
                      id:
                        type: string
                      filename:
                        type: string
                      size:
                        type: integer
                      content_type:
                        type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /files/{id}/download:
    get:
      tags: [files]
      summary: Download a file
      operationId: downloadFile
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: expires
          in: query
          schema:
            type: integer
            format: int64
          description: Unix timestamp when the signed URL expires
        - name: uid
          in: query
          schema:
            type: string
          description: User ID for signed URL verification
        - name: sig
          in: query
          schema:
            type: string
          description: HMAC-SHA256 signature for signed URL verification
      responses:
        '200':
          description: File content
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /files/{id}/sign-url:
    post:
      tags: [files]
      summary: Get a signed download URL for a file
      operationId: signFileUrl
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Signed URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignedUrl'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /files/sign-urls:
    post:
      tags: [files]
      summary: Get signed download URLs for multiple files
      operationId: signFileUrls
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [file_ids]
              properties:
                file_ids:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Signed URLs
          content:
            application/json:
              schema:
                type: object
                required: [urls]
                properties:
                  urls:
                    type: array
                    items:
                      $ref: '#/components/schemas/SignedUrl'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /files/{id}/delete:
    post:
      tags: [files]
      summary: Delete a file
      operationId: deleteFile
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: File deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # Emoji endpoints
  /workspaces/{wid}/emojis/upload:
    post:
      tags: [emojis]
      summary: Upload a custom emoji
      operationId: uploadCustomEmoji
      security:
        - bearerAuth: []
      parameters:
        - name: wid
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file, name]
              properties:
                file:
                  type: string
                  format: binary
                name:
                  type: string
      responses:
        '200':
          description: Emoji uploaded
          content:
            application/json:
              schema:
                type: object
                required: [emoji]
                properties:
                  emoji:
                    $ref: '#/components/schemas/CustomEmoji'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /workspaces/{wid}/emojis/list:
    post:
      tags: [emojis]
      summary: List custom emojis for a workspace
      operationId: listCustomEmojis
      security:
        - bearerAuth: []
      parameters:
        - name: wid
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of custom emojis
          content:
            application/json:
              schema:
                type: object
                required: [emojis]
                properties:
                  emojis:
                    type: array
                    items:
                      $ref: '#/components/schemas/CustomEmoji'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /emojis/{id}/delete:
    post:
      tags: [emojis]
      summary: Delete a custom emoji
      operationId: deleteCustomEmoji
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Emoji deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # User endpoints
  /users/{id}:
    get:
      tags: [users]
      summary: Get user profile
      operationId: getUser
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: User ID
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/UserProfile'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /users/me/profile:
    post:
      tags: [users]
      summary: Update own profile
      operationId: updateProfile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileInput'
      responses:
        '200':
          description: Profile updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '400':
          $ref: '#/components/responses/BadRequest'

  /users/me/avatar:
    post:
      tags: [users]
      summary: Upload avatar image
      operationId: uploadAvatar
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: Avatar uploaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AvatarUploadResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '400':
          $ref: '#/components/responses/BadRequest'
    delete:
      tags: [users]
      summary: Remove avatar
      operationId: deleteAvatar
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Avatar removed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /workspaces/{wid}/icon:
    post:
      tags: [workspaces]
      summary: Upload workspace icon
      operationId: uploadWorkspaceIcon
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: Icon uploaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkspaceIconUploadResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '400':
          $ref: '#/components/responses/BadRequest'
    delete:
      tags: [workspaces]
      summary: Remove workspace icon
      operationId: deleteWorkspaceIcon
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      responses:
        '200':
          description: Icon removed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  # SSE endpoints
  /workspaces/{wid}/events:
    get:
      tags: [sse]
      summary: SSE event stream
      operationId: events
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      responses:
        '200':
          description: SSE event stream
          content:
            text/event-stream:
              schema:
                type: string

  /workspaces/{wid}/typing/start:
    post:
      tags: [sse]
      summary: Start typing indicator
      operationId: startTyping
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [channel_id]
              properties:
                channel_id:
                  type: string
      responses:
        '200':
          description: Typing started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /workspaces/{wid}/typing/stop:
    post:
      tags: [sse]
      summary: Stop typing indicator
      operationId: stopTyping
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/workspaceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [channel_id]
              properties:
                channel_id:
                  type: string
      responses:
        '200':
          description: Typing stopped
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer

  parameters:
    workspaceId:
      name: wid
      in: path
      required: true
      schema:
        type: string
      description: Workspace ID
    channelId:
      name: id
      in: path
      required: true
      schema:
        type: string
      description: Channel ID
    messageId:
      name: id
      in: path
      required: true
      schema:
        type: string
      description: Message ID

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiErrorResponse'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiErrorResponse'
    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiErrorResponse'
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiErrorResponse'

  schemas:
    # User schemas
    UserProfile:
      type: object
      required: [id, display_name, status, created_at]
      properties:
        id:
          type: string
        display_name:
          type: string
        avatar_url:
          type: string
        gravatar_url:
          type: string
        status:
          type: string
        created_at:
          type: string
          format: date-time

    UpdateProfileInput:
      type: object
      properties:
        display_name:
          type: string

    AvatarUploadResponse:
      type: object
      required: [avatar_url]
      properties:
        avatar_url:
          type: string

    WorkspaceIconUploadResponse:
      type: object
      required: [icon_url]
      properties:
        icon_url:
          type: string

    User:
      type: object
      required: [id, email, display_name, status, created_at, updated_at]
      properties:
        id:
          type: string
        email:
          type: string
          format: email
        email_verified_at:
          type: string
          format: date-time
        display_name:
          type: string
        avatar_url:
          type: string
        gravatar_url:
          type: string
        status:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # Workspace schemas
    WorkspaceSettings:
      type: object
      properties:
        show_join_leave_messages:
          type: boolean
          default: true
          description: Whether to show system messages when users join or leave channels

    Workspace:
      type: object
      required: [id, name, settings, created_at, updated_at]
      properties:
        id:
          type: string
        name:
          type: string
        icon_url:
          type: string
        settings:
          type: string
          description: JSON string containing workspace settings (for backward compatibility)
        parsed_settings:
          $ref: '#/components/schemas/WorkspaceSettings'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    WorkspaceSummary:
      type: object
      required: [id, name, role]
      properties:
        id:
          type: string
        name:
          type: string
        icon_url:
          type: string
        role:
          $ref: '#/components/schemas/WorkspaceRole'
        sort_order:
          type: integer
          description: User's custom sort order for this workspace

    WorkspaceNotificationSummary:
      type: object
      required: [workspace_id, unread_count, notification_count]
      properties:
        workspace_id:
          type: string
        unread_count:
          type: integer
        notification_count:
          type: integer

    WorkspaceMembership:
      type: object
      required: [id, user_id, workspace_id, role, created_at, updated_at]
      properties:
        id:
          type: string
        user_id:
          type: string
        workspace_id:
          type: string
        role:
          $ref: '#/components/schemas/WorkspaceRole'
        display_name_override:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    WorkspaceMemberWithUser:
      allOf:
        - $ref: '#/components/schemas/WorkspaceMembership'
        - type: object
          required: [email, display_name]
          properties:
            email:
              type: string
              format: email
            display_name:
              type: string
            avatar_url:
              type: string
            gravatar_url:
              type: string

    WorkspaceRole:
      type: string
      enum: [owner, admin, member, guest]

    Invite:
      type: object
      required: [id, workspace_id, code, role, use_count, created_at]
      properties:
        id:
          type: string
        workspace_id:
          type: string
        code:
          type: string
        invited_email:
          type: string
          format: email
        role:
          $ref: '#/components/schemas/WorkspaceRole'
        created_by:
          type: string
        max_uses:
          type: integer
        use_count:
          type: integer
        expires_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time

    # Channel schemas
    Channel:
      type: object
      required: [id, workspace_id, name, type, is_default, created_at, updated_at]
      properties:
        id:
          type: string
        workspace_id:
          type: string
        name:
          type: string
        description:
          type: string
        type:
          $ref: '#/components/schemas/ChannelType'
        is_default:
          type: boolean
          description: Whether this is the default channel (like #general in Slack)
        dm_participant_hash:
          type: string
        archived_at:
          type: string
          format: date-time
        created_by:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ChannelWithMembership:
      allOf:
        - $ref: '#/components/schemas/Channel'
        - type: object
          required: [unread_count, is_starred, notification_count]
          properties:
            channel_role:
              $ref: '#/components/schemas/ChannelRole'
            last_read_message_id:
              type: string
            unread_count:
              type: integer
            notification_count:
              type: integer
            is_starred:
              type: boolean
            dm_participants:
              type: array
              items:
                $ref: '#/components/schemas/ChannelMember'
              description: For DM channels, the other participants (excluding current user)

    ChannelType:
      type: string
      enum: [public, private, dm, group_dm]

    ChannelRole:
      type: string
      enum: [admin, poster, viewer]

    ChannelMember:
      type: object
      required: [user_id, email, display_name]
      properties:
        user_id:
          type: string
        email:
          type: string
          format: email
        display_name:
          type: string
        avatar_url:
          type: string
        gravatar_url:
          type: string
        channel_role:
          $ref: '#/components/schemas/ChannelRole'

    DMSuggestionsResponse:
      type: object
      required: [recent_dms, suggested_users]
      properties:
        recent_dms:
          type: array
          items:
            $ref: '#/components/schemas/ChannelWithMembership'
          description: DM channels with recent activity
        suggested_users:
          type: array
          items:
            $ref: '#/components/schemas/SuggestedUser'
          description: Workspace members suggested for starting new conversations

    SuggestedUser:
      type: object
      required: [id, display_name]
      properties:
        id:
          type: string
        email:
          type: string
          format: email
        display_name:
          type: string
        avatar_url:
          type: string
        gravatar_url:
          type: string

    # Message schemas
    MessageType:
      type: string
      enum: [user, system]

    SystemEventType:
      type: string
      enum: [user_joined, user_left, user_added, user_converted_channel, channel_renamed, channel_visibility_changed, channel_description_updated]

    SystemEventData:
      type: object
      required: [event_type, user_id, user_display_name, channel_name]
      properties:
        event_type:
          $ref: '#/components/schemas/SystemEventType'
        user_id:
          type: string
          description: The user who joined/left/was added
        user_display_name:
          type: string
          description: Display name of the user at the time of the event
        channel_name:
          type: string
          description: Name of the channel
        actor_id:
          type: string
          description: The user who performed the action (for user_added)
        actor_display_name:
          type: string
          description: Display name of the actor
        old_channel_name:
          type: string
          description: Previous channel name (for rename events)
        channel_type:
          type: string
          description: New channel type (for visibility change events)

    Message:
      type: object
      required: [id, channel_id, content, reply_count, created_at, updated_at]
      properties:
        id:
          type: string
        channel_id:
          type: string
        user_id:
          type: string
        content:
          type: string
        type:
          $ref: '#/components/schemas/MessageType'
        system_event:
          $ref: '#/components/schemas/SystemEventData'
        thread_parent_id:
          type: string
        reply_count:
          type: integer
        last_reply_at:
          type: string
          format: date-time
        edited_at:
          type: string
          format: date-time
        deleted_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        also_send_to_channel:
          type: boolean

    MessageWithUser:
      allOf:
        - $ref: '#/components/schemas/Message'
        - type: object
          properties:
            user_display_name:
              type: string
            user_avatar_url:
              type: string
            user_gravatar_url:
              type: string
            reactions:
              type: array
              items:
                $ref: '#/components/schemas/Reaction'
            thread_participants:
              type: array
              items:
                $ref: '#/components/schemas/ThreadParticipant'
            attachments:
              type: array
              items:
                $ref: '#/components/schemas/Attachment'

    ThreadParticipant:
      type: object
      required: [user_id]
      properties:
        user_id:
          type: string
        display_name:
          type: string
        avatar_url:
          type: string
        gravatar_url:
          type: string

    Attachment:
      type: object
      required: [id, filename, content_type, size_bytes, url, created_at]
      properties:
        id:
          type: string
        filename:
          type: string
        content_type:
          type: string
        size_bytes:
          type: integer
          format: int64
        url:
          type: string
          description: Download URL for the attachment
        created_at:
          type: string
          format: date-time

    Reaction:
      type: object
      required: [id, message_id, user_id, emoji, created_at]
      properties:
        id:
          type: string
        message_id:
          type: string
        user_id:
          type: string
        emoji:
          type: string
        created_at:
          type: string
          format: date-time

    ReactionSummary:
      type: object
      required: [emoji, count, user_ids]
      properties:
        emoji:
          type: string
        count:
          type: integer
        user_ids:
          type: array
          items:
            type: string

    MessageListResult:
      type: object
      required: [messages, has_more]
      properties:
        messages:
          type: array
          items:
            $ref: '#/components/schemas/MessageWithUser'
        has_more:
          type: boolean
        has_newer:
          type: boolean
        next_cursor:
          type: string

    UnreadMessage:
      allOf:
        - $ref: '#/components/schemas/MessageWithUser'
        - type: object
          required: [channel_name, channel_type]
          properties:
            channel_name:
              type: string
            channel_type:
              $ref: '#/components/schemas/ChannelType'

    UnreadMessagesResult:
      type: object
      required: [messages, has_more]
      properties:
        messages:
          type: array
          items:
            $ref: '#/components/schemas/UnreadMessage'
        has_more:
          type: boolean
        next_cursor:
          type: string

    SearchMessagesInput:
      type: object
      required: [query]
      properties:
        query:
          type: string
        channel_id:
          type: string
        user_id:
          type: string
        before:
          type: string
          format: date-time
        after:
          type: string
          format: date-time
        limit:
          type: integer
          default: 20
        offset:
          type: integer
          default: 0

    SearchMessage:
      allOf:
        - $ref: '#/components/schemas/MessageWithUser'
        - type: object
          required: [channel_name, channel_type]
          properties:
            channel_name:
              type: string
            channel_type:
              $ref: '#/components/schemas/ChannelType'

    SearchMessagesResult:
      type: object
      required: [messages, total_count, has_more, query]
      properties:
        messages:
          type: array
          items:
            $ref: '#/components/schemas/SearchMessage'
        total_count:
          type: integer
        has_more:
          type: boolean
        query:
          type: string

    ThreadMessage:
      allOf:
        - $ref: '#/components/schemas/MessageWithUser'
        - type: object
          required: [channel_name, channel_type, has_new_replies]
          properties:
            channel_name:
              type: string
            channel_type:
              $ref: '#/components/schemas/ChannelType'
            has_new_replies:
              type: boolean

    ThreadListResult:
      type: object
      required: [threads, has_more, unread_thread_count]
      properties:
        threads:
          type: array
          items:
            $ref: '#/components/schemas/ThreadMessage'
        has_more:
          type: boolean
        next_cursor:
          type: string
        unread_thread_count:
          type: integer

    # API response schemas
    ApiError:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
        message:
          type: string

    ApiErrorResponse:
      type: object
      required: [error]
      properties:
        error:
          $ref: '#/components/schemas/ApiError'

    CustomEmoji:
      type: object
      required: [id, workspace_id, name, created_by, content_type, size_bytes, url, created_at]
      properties:
        id:
          type: string
        workspace_id:
          type: string
        name:
          type: string
        created_by:
          type: string
        content_type:
          type: string
        size_bytes:
          type: integer
          format: int64
        url:
          type: string
        created_at:
          type: string
          format: date-time

    SignedUrl:
      type: object
      required: [file_id, url, expires_at]
      properties:
        file_id:
          type: string
        url:
          type: string
        expires_at:
          type: string
          format: date-time

    ServerInfo:
      type: object
      required: [version]
      properties:
        version:
          type: string

    SuccessResponse:
      type: object
      required: [success]
      properties:
        success:
          type: boolean

    MarkReadResponse:
      type: object
      required: [last_read_message_id]
      properties:
        last_read_message_id:
          type: string

    ChannelReadEventData:
      type: object
      required: [channel_id, last_read_message_id]
      properties:
        channel_id:
          type: string
        last_read_message_id:
          type: string

    # SSE schemas
    SSEEventType:
      type: string
      enum:
        - connected
        - heartbeat
        - message.new
        - message.updated
        - message.deleted
        - reaction.added
        - reaction.removed
        - channel.created
        - channel.updated
        - channel.archived
        - channel.member_added
        - channel.member_removed
        - channel.read
        - typing.start
        - typing.stop
        - presence.changed
        - presence.initial
        - notification
        - emoji.created
        - emoji.deleted

    SSEEvent:
      oneOf:
        - $ref: '#/components/schemas/SSEEventConnected'
        - $ref: '#/components/schemas/SSEEventHeartbeat'
        - $ref: '#/components/schemas/SSEEventMessageNew'
        - $ref: '#/components/schemas/SSEEventMessageUpdated'
        - $ref: '#/components/schemas/SSEEventMessageDeleted'
        - $ref: '#/components/schemas/SSEEventReactionAdded'
        - $ref: '#/components/schemas/SSEEventReactionRemoved'
        - $ref: '#/components/schemas/SSEEventChannelCreated'
        - $ref: '#/components/schemas/SSEEventChannelUpdated'
        - $ref: '#/components/schemas/SSEEventChannelArchived'
        - $ref: '#/components/schemas/SSEEventChannelMemberAdded'
        - $ref: '#/components/schemas/SSEEventChannelMemberRemoved'
        - $ref: '#/components/schemas/SSEEventChannelRead'
        - $ref: '#/components/schemas/SSEEventTypingStart'
        - $ref: '#/components/schemas/SSEEventTypingStop'
        - $ref: '#/components/schemas/SSEEventPresenceChanged'
        - $ref: '#/components/schemas/SSEEventPresenceInitial'
        - $ref: '#/components/schemas/SSEEventNotification'
        - $ref: '#/components/schemas/SSEEventEmojiCreated'
        - $ref: '#/components/schemas/SSEEventEmojiDeleted'
      discriminator:
        propertyName: type
        mapping:
          connected: '#/components/schemas/SSEEventConnected'
          heartbeat: '#/components/schemas/SSEEventHeartbeat'
          message.new: '#/components/schemas/SSEEventMessageNew'
          message.updated: '#/components/schemas/SSEEventMessageUpdated'
          message.deleted: '#/components/schemas/SSEEventMessageDeleted'
          reaction.added: '#/components/schemas/SSEEventReactionAdded'
          reaction.removed: '#/components/schemas/SSEEventReactionRemoved'
          channel.created: '#/components/schemas/SSEEventChannelCreated'
          channel.updated: '#/components/schemas/SSEEventChannelUpdated'
          channel.archived: '#/components/schemas/SSEEventChannelArchived'
          channel.member_added: '#/components/schemas/SSEEventChannelMemberAdded'
          channel.member_removed: '#/components/schemas/SSEEventChannelMemberRemoved'
          channel.read: '#/components/schemas/SSEEventChannelRead'
          typing.start: '#/components/schemas/SSEEventTypingStart'
          typing.stop: '#/components/schemas/SSEEventTypingStop'
          presence.changed: '#/components/schemas/SSEEventPresenceChanged'
          presence.initial: '#/components/schemas/SSEEventPresenceInitial'
          notification: '#/components/schemas/SSEEventNotification'
          emoji.created: '#/components/schemas/SSEEventEmojiCreated'
          emoji.deleted: '#/components/schemas/SSEEventEmojiDeleted'

    SSEEventConnected:
      type: object
      required: [type]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [connected]

    SSEEventHeartbeat:
      type: object
      required: [type]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [heartbeat]

    SSEEventMessageNew:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [message.new]
        data:
          $ref: '#/components/schemas/MessageWithUser'

    SSEEventMessageUpdated:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [message.updated]
        data:
          $ref: '#/components/schemas/MessageWithUser'

    SSEEventMessageDeleted:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [message.deleted]
        data:
          type: object
          required: [id]
          properties:
            id:
              type: string
            thread_parent_id:
              type: string

    SSEEventReactionAdded:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [reaction.added]
        data:
          $ref: '#/components/schemas/Reaction'

    SSEEventReactionRemoved:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [reaction.removed]
        data:
          type: object
          required: [message_id, user_id, emoji]
          properties:
            message_id:
              type: string
            user_id:
              type: string
            emoji:
              type: string

    SSEEventChannelCreated:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [channel.created]
        data:
          $ref: '#/components/schemas/Channel'

    SSEEventChannelUpdated:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [channel.updated]
        data:
          $ref: '#/components/schemas/Channel'

    SSEEventChannelArchived:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [channel.archived]
        data:
          $ref: '#/components/schemas/Channel'

    SSEEventChannelMemberAdded:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [channel.member_added]
        data:
          type: object
          required: [channel_id]
          properties:
            channel_id:
              type: string

    SSEEventChannelMemberRemoved:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [channel.member_removed]
        data:
          type: object
          required: [channel_id]
          properties:
            channel_id:
              type: string

    SSEEventChannelRead:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [channel.read]
        data:
          $ref: '#/components/schemas/ChannelReadEventData'

    SSEEventTypingStart:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [typing.start]
        data:
          $ref: '#/components/schemas/TypingEventData'

    SSEEventTypingStop:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [typing.stop]
        data:
          $ref: '#/components/schemas/TypingEventData'

    SSEEventPresenceChanged:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [presence.changed]
        data:
          $ref: '#/components/schemas/PresenceData'

    SSEEventPresenceInitial:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [presence.initial]
        data:
          $ref: '#/components/schemas/PresenceInitialData'

    PresenceInitialData:
      type: object
      required: [online_user_ids]
      properties:
        online_user_ids:
          type: array
          items:
            type: string
          description: List of user IDs currently online in this workspace

    SSEEventNotification:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [notification]
        data:
          $ref: '#/components/schemas/NotificationData'

    SSEEventEmojiCreated:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [emoji.created]
        data:
          $ref: '#/components/schemas/CustomEmoji'

    SSEEventEmojiDeleted:
      type: object
      required: [type, data]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [emoji.deleted]
        data:
          type: object
          required: [id, name]
          properties:
            id:
              type: string
            name:
              type: string

    NotificationData:
      type: object
      required: [type, channel_id, message_id]
      properties:
        type:
          type: string
          enum: [mention, dm, channel, here, everyone, thread_reply]
        channel_id:
          type: string
        message_id:
          type: string
        channel_name:
          type: string
        sender_name:
          type: string
        preview:
          type: string
        thread_parent_id:
          type: string

    ThreadSubscriptionStatus:
      type: string
      enum: [subscribed, unsubscribed, none]

    NotifyLevel:
      type: string
      enum: [all, mentions, none]

    NotificationPreferences:
      type: object
      required: [notify_level, email_enabled]
      properties:
        notify_level:
          $ref: '#/components/schemas/NotifyLevel'
        email_enabled:
          type: boolean

    TypingEventData:
      type: object
      required: [user_id, channel_id]
      properties:
        user_id:
          type: string
        channel_id:
          type: string
        user_display_name:
          type: string

    PresenceStatus:
      type: string
      enum: [online, offline]

    PresenceData:
      type: object
      required: [user_id, status]
      properties:
        user_id:
          type: string
        status:
          $ref: '#/components/schemas/PresenceStatus'

    # Input schemas
    RegisterInput:
      type: object
      required: [email, password, display_name]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
        display_name:
          type: string

    LoginInput:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    AuthResponse:
      type: object
      required: [user, token]
      properties:
        user:
          $ref: '#/components/schemas/User'
        token:
          type: string

    MeResponse:
      type: object
      required: [user]
      properties:
        user:
          $ref: '#/components/schemas/User'
        workspaces:
          type: array
          items:
            $ref: '#/components/schemas/WorkspaceSummary'

    CreateWorkspaceInput:
      type: object
      required: [name]
      properties:
        name:
          type: string

    UpdateWorkspaceInput:
      type: object
      properties:
        name:
          type: string
        settings:
          $ref: '#/components/schemas/WorkspaceSettings'

    CreateInviteInput:
      type: object
      required: [role]
      properties:
        invited_email:
          type: string
          format: email
        role:
          $ref: '#/components/schemas/WorkspaceRole'
        max_uses:
          type: integer
        expires_in_hours:
          type: integer

    CreateChannelInput:
      type: object
      required: [name, type]
      properties:
        name:
          type: string
        description:
          type: string
        type:
          $ref: '#/components/schemas/ChannelType'

    UpdateChannelInput:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        type:
          $ref: '#/components/schemas/ChannelType'

    SendMessageInput:
      type: object
      properties:
        content:
          type: string
        thread_parent_id:
          type: string
        attachment_ids:
          type: array
          items:
            type: string
          description: IDs of uploaded attachments to include with this message
        also_send_to_channel:
          type: boolean
          description: When replying in a thread, also show the reply in the channel

    ListMessagesInput:
      type: object
      properties:
        cursor:
          type: string
        limit:
          type: integer
        direction:
          type: string
          enum: [before, after, around]

    ReorderWorkspacesInput:
      type: object
      required: [workspace_ids]
      properties:
        workspace_ids:
          type: array
          items:
            type: string
          description: Ordered list of workspace IDs representing the new order
